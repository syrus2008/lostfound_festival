{% extends 'admin/base.html' %}
{% block admin_title %}Demandes de suppression{% endblock %}
{% block admin_content %}
<div class="card shadow-sm border-0">
  <div class="card-body">
    <h2>Demandes de suppression d'objets</h2>
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Titre</th>
          <th>Catégorie</th>
          <th>Déclarant</th>
          <th>Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td>{{ item.id }}</td>
          <td>
            <a href="{{ url_for('main.detail_item', item_id=item.id) }}">{{ item.title }}</a>
            {% if item.photos and item.photos|length > 0 %}
              <br>
              <img src="{{ url_for('main.uploaded_file', filename=item.photos[0].filename) }}" alt="Photo objet" style="max-width:60px; max-height:60px; border-radius:6px; margin-top:2px;">
            {% elif item.photo_filename %}
              <br>
              <img src="{{ url_for('main.uploaded_file', filename=item.photo_filename) }}" alt="Photo objet" style="max-width:60px; max-height:60px; border-radius:6px; margin-top:2px;">
            {% endif %}
          </td>
          <td>{{ item.category.name if item.category else '—' }}</td>
          <td>{{ item.reporter_name }}</td>
          <td>{{ item.date_reported.strftime('%d/%m/%Y') }}</td>
          <td class="text-nowrap">
            <a href="{{ url_for('main.detail_item', item_id=item.id) }}" class="btn btn-sm btn-outline-primary mb-1">Détail</a>
            <form method="post" action="{{ url_for('admin.confirm_deletion', item_id=item.id) }}" style="display:inline-block;">
              {{ csrf_form.hidden_tag() }}
              <button class="btn btn-sm btn-danger mb-1" type="submit" title="Supprimer"><i class="bi bi-check-circle"></i> Supprimer</button>
            </form>
            <form method="post" action="{{ url_for('admin.reject_deletion', item_id=item.id) }}" style="display:inline-block;">
              {{ csrf_form.hidden_tag() }}
              <button class="btn btn-sm btn-secondary mb-1" type="submit" title="Rejeter"><i class="bi bi-x-circle"></i> Rejeter</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="text-center">Aucune demande en attente</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for item in items %}
    <tr>
      <td>{{ item.id }}</td>
      <td><a href="{{ url_for('main.detail_item', item_id=item.id) }}">{{ item.title }}</a></td>
      <td>{{ item.category.name if item.category else '—' }}</td>
      <td>{{ item.reporter_name }}</td>
      <td>{{ item.date_reported.strftime('%d/%m/%Y %H:%M') }}</td>
      <td>
        <form method="post" action="{{ url_for('admin.confirm_deletion', item_id=item.id) }}" style="display:inline;">
          {{ csrf_form.hidden_tag() }}
          <button type="submit" class="btn btn-danger btn-sm">Confirmer suppression</button>
        </form>
        <form method="post" action="{{ url_for('admin.reject_deletion', item_id=item.id) }}" style="display:inline;">
          {{ csrf_form.hidden_tag() }}
          <button type="submit" class="btn btn-secondary btn-sm">Rejeter</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr><td colspan="6" class="text-center">Aucune demande en attente</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
